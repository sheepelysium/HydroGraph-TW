# HydroGraph-TW 專案規範

## 📁 目錄結構規範

### scripts/
**用途**：主要程式碼
- 所有核心功能腳本放在此目錄
- 檔案命名：使用數字前綴表示執行順序（如：`1_extract_rivers.py`, `2_extract_stations.py`）
- 每個腳本應該是獨立可執行的
- 必須包含 `if __name__ == "__main__":` 區塊

### test/
**用途**：測試程式碼
- 所有測試、除錯、驗證用的臨時腳本
- 檔案命名：`test_*.py` 或 `check_*.py`
- 這個目錄的檔案不應該被提交到正式版本
- 測試完成後應該清理刪除

### file/
**用途**：外部輸入檔案
- 所有外部來源的原始資料
- PDF、Excel、Shapefile 等輸入檔案
- 只讀，不應該被程式修改
- 範例：`台灣地區河川代碼(112年).pdf`, `測站基本資料2025.xlsx`

### data/
**用途**：程式產生的輸出檔案
- 所有由腳本處理後產生的資料
- Excel 報表、處理後的資料檔案
- 可以被程式覆寫或重新生成
- 範例：`河川關係_完整版.xlsx`, `測站河川配對分析報表.xlsx`

## 🔧 編碼規範

### Python 腳本
- 所有 Python 檔案必須包含 UTF-8 編碼聲明：`# -*- coding: utf-8 -*-`
- 使用 docstring 說明函數和腳本用途
- 函數命名：使用 snake_case（如：`extract_river_names`）
- 變數命名：使用 snake_case，應該具有描述性

### 資料處理
- 使用 pandas 處理 Excel 資料
- 使用 openpyxl 作為 Excel 引擎
- 所有輸出的 Excel 檔案應該設定凍結窗格（freeze_panes = 'A2'）
- 清理資料時必須去除尾隨空白：`.strip()`

### 錯誤處理
- 讀取檔案前檢查檔案是否存在
- 使用 try-except 處理可能的編碼錯誤（UnicodeEncodeError）
- 在控制台輸出中文時，使用 `errors='replace'` 處理編碼問題

## 📝 檔案命名規範

### 腳本檔案
- 主要程式：`{序號}_{功能描述}.py`
  - 範例：`1_extract_rivers_from_pdf.py`
  - 序號用於表示執行順序

### 資料檔案
- 中間處理結果：`{資料類型}_{處理階段}.xlsx`
  - 範例：`測站資料_水位與氣象.xlsx`

- 最終報表：`{報表名稱}_報表.xlsx` 或 `{功能描述}_分析報表.xlsx`
  - 範例：`測站河川配對分析報表.xlsx`

## ⚠️ 注意事項

### 資料品質
- **尾隨空白問題**：測站資料經常有尾隨空白，必須清理
- **河川名稱變體**：需處理括號別名（如：`乾溪(里仁溪)`）
- **多行文字**：PDF 提取時可能產生換行，需合併處理

### 專案特定規則
- 使用 `venv/Scripts/python.exe` 執行 Python（Windows）
- 河川資料有 5 層階層關係（主流 → 支流 → 次支流 → 次次支流 → 次次次支流）
- 測站資料僅處理水位和氣象測站，排除地下水位
- 匹配邏輯：優先直接匹配，其次別名匹配

### 輸出規範
- 所有報表都使用 UTF-8 編碼
- Excel 工作表名稱使用中文描述
- 統計數據應包含數量和百分比
- 對於不確定的統計結果，應該標註「有待確認」而非斷言

## 🚫 避免事項 (嚴格遵守!)

### ⚠️ 開始任務前必讀: /project-rules

- ❌ **絕對禁止在根目錄創建測試/調試檔案**
  - 不可創建: test_*.py, debug_*.py, check_*.py, verify_*.py
  - 不可創建: 任何 .txt 輸出檔案
  - 調試腳本必須放在 test/debug/ 目錄

- ❌ 不要直接修改 file/ 目錄下的原始資料
- ❌ 不要創建不必要的中間版本檔案
- ❌ 不要使用絕對路徑，應使用相對路徑
- ❌ 不要假設資料完全準確，特別是監測覆蓋率相關的結論

### 🎯 正確做法:
- ✅ 調試腳本 → test/debug/
- ✅ 測試腳本 → test/
- ✅ 正式腳本 → scripts/
- ✅ 輸出資料 → data/
- ✅ 完成後刪除臨時檔案

## 📚 依賴套件

必要套件：
- pandas - 資料處理
- openpyxl - Excel 讀寫
- pdfplumber - PDF 提取
- geopandas - GIS 資料處理（未來使用）

## 🔄 工作流程

標準處理流程：
1. `scripts/1_extract_rivers_from_pdf.py` - 提取河川資料
2. `scripts/2_extract_stations.py` - 提取測站資料
3. `scripts/3_generate_final_report.py` - 產生最終配對報表

每個腳本都應該：
- 讀取 file/ 或 data/ 中的輸入檔案
- 處理並分析資料
- 輸出結果到 data/ 目錄
- 在控制台顯示處理進度和統計摘要
